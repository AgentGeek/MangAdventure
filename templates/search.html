{% extends 'skeleton.html' %}
{% load custom_tags %}
{% load static %}
{% load inlinecompile from compile_static %}
{% block head_extras %}
  <style type="text/css">
    {% inlinecompile 'scss' %}
      {% include 'scss/search.django.scss' %}
    {% endinlinecompile %}
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tablesort/5.1.0/tablesort.min.js"
          integrity="sha384-X4ygFY9D+rThZo+qYAK0a6e80aea1N6ZJT5pClZ/lFeji8fTw2MYtxHoXYkvWFA5"
          crossorigin="anonymous" type="text/javascript"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tablesort/5.1.0/sorts/tablesort.number.min.js"
          integrity="sha384-6i1Ebthcj0aIZq17cuL3wYI7KWqByGszxDcURQVUDBUq5xt9bBlF6kOPuYpkVOuN"
          crossorigin="anonymous" type="text/javascript"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tablesort/5.1.0/sorts/tablesort.date.min.js"
          integrity="sha384-FS9DiHTRu5S2IsfHVyB0DgxutdvNZ8TrlWaOXsWfdvWGjJakqS3DDT0dLLS80r2H"
          crossorigin="anonymous" type="text/javascript"></script>
  <script src="{% static 'scripts/search.js' %}"
          integrity="{% sha256hash 'scripts/search.js' %}"
          crossorigin="anonymous" type="text/javascript" async></script>
{% endblock %}
{% block title %}
  <meta name="title" content="Search">
  <meta name="twitter:title" content="Search - {{ config.NAME }}">
  <meta property="og:title" content="Search - {{ config.NAME }}">
  <title>Search :: {{ config.NAME }}</title>
{% endblock %}
{% block content %}
  <h1 class="text-shadow alter-bg">Search</h1>
  <article id="search">
    <section id="search-options">
      <form action="/search" id="search-form"
            method="GET" accept-charset="utf-8">
        <div id="search-title">
          <label for="query" class="colon">Series Title</label>
          <input name="q" value="{{ query }}"
                id="query" type="text"/>
        </div>
        <div id="search-author">
          <label for="author" class="colon">Author/Artist</label>
          <input name="author" value="{{ author }}"
                 id="author" type="text"/>
        </div>
        <div id="search-status">
          <span class="colon">Series Status</span>
          <input {% if status == 'any' %}checked="checked"{% endif %}
                 name="status" id="status-any" value="any" type="radio"/>
          <label for="status-any">Any</label>
          <input {% if status == 'completed' %}checked="checked"{% endif %}
                 name="status" id="status-completed" value="completed" type="radio"/>
          <label for="status-completed">Completed</label>
          <input {% if status == 'ongoing' %}checked="checked"{% endif %}
                 name="status" id="status-ongoing" value="ongoing" type="radio"/>
          <label for="status-ongoing">Ongoing</label>
        </div>
        <div id="search-categories">
          <div class="colon">Categories</div>
          <div>(
            <i class="far fa-check-circle fa-fw"></i> = include /
            <i class="far fa-times-circle fa-fw"></i> = exclude )
          </div>
          <div id="category-container">
            {% for category in all_categories %}
              <span class="tooltip category" data-value=""
                   data-tooltip="{{ category.description }}">
                {% if category|lower in in_categories %}
                  <i class="far fa-check-circle fa-fw"></i> {{ category.name }}
                {% elif category|lower in ex_categories %}
                  <i class="far fa-times-circle fa-fw"></i> {{ category.name }}
                {% else %}
                  <i class="far fa-circle fa-fw"></i> {{ category.name }}
                {% endif %}
              </span>
            {% endfor %}
          </div>
          <input type="text" class="no-display"
                 id="categories" name="categories" hidden/>
        </div>
        <button id="search-submit" type="submit">
          <i class="fa fa-paper-plane"></i> Submit Search
        </button>
      </form>
    </section>
    <section id="search-results">
    {% if results %}
      <table id="result-table">
        <thead>
          <tr>
            <th data-sort-default>Series<i class="fas"></i></th>
            <th class="s-hidden">Author / Artist<i class="fas"></i></th>
            <th class="s-hidden">Description<i class="fas"></i></th>
            <th class="s-hidden">Chapters<i class="fas"></i></th>
            <th class="s-hidden">Last Update<i class="fas"></i></th>
          </tr>
        </thead>
        {% for series in results|order_by:'title' %}
          {% if series.chapters.all %}
            <tr class="result">
              <td class="result-title">
                {% if series.completed %}
                  <i class="fa fa-fw fa-book" title="Completed"></i>
                {% else %}
                  <i class="fa fa-fw fa-book-open" title="Ongoing"></i>
                {% endif %}
                <a href="/reader/{{ series.slug }}"
                   title="{{ series.title }}">
                  {{ series.title }}
                </a>
              </td>
              <td class="result-people s-hidden">
                <span class="result-authors">
                  {% if series.authors.all %}
                    {{ series.authors.all|join:' & ' }}
                  {% else %}
                    N/A
                  {% endif %}
                </span>
                <span class="result-artists">
                  {% if series.artists.all %}
                    {{ series.artists.all|join:' & ' }}
                  {% else %}
                    N/A
                  {% endif %}
                </span>
              </td>
              <td class="result-desc s-hidden">
                {{ series.description|default:'N/A' }}
              </td>
              <td class="result-chapters s-hidden" data-sort-method="number">
                {{ series.chapters.count }}
              </td>
              <td class="result-date s-hidden" data-sort-method="date">
                {% if series.chapters.all %}
                  {{ series.chapters.latest.uploaded|date:'N d, Y - H:i' }}
                {% else %}
                  N/A
                {% endif %}
              </td>
            </tr>
          {% endif %}
        {% endfor %}
      </table>
    {% endif %}
    </section>
  </article>
{% endblock %}

